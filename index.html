<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EM AREA - Le Grand March√© Digital</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <script>
        // Init Dark Mode
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script>
</head>
<body>

    <header>
        <div class="header-content">
            <div class="top-bar-mobile">
                <a href="#" class="logo">EM <span>AREA</span></a>
                <div style="display:flex; gap:10px; align-items:center;">
                    <button class="theme-btn" id="theme-toggle">üåô</button>
                    <a href="#" id="fav-btn-mobile" class="seller-link" style="border:none;background:none;font-size:1.5rem;padding:0;">‚ù§Ô∏è</a>
                    <a href="vendre.html" class="seller-link">Vendre</a>
                </div>
            </div>

            <a href="#" class="logo desktop-only">EM <span>AREA</span></a>

            <div class="search-container">
                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="Je cherche...">
                    <button>üîç</button>
                </div>
                <select id="sort-select" class="sort-select">
                    <option value="random">Al√©atoire</option>
                    <option value="new">Nouveaut√©s</option>
                    <option value="price-asc">Prix Croissant</option>
                    <option value="dist">üìç Proximit√© (GPS)</option> <!-- NOUVEAU OPTION 10 -->
                </select>
                <button class="theme-btn desktop-only" id="theme-toggle-desktop">üåô</button>
            </div>
            
            <a href="vendre.html" class="seller-link desktop-only">Devenir Vendeur</a>
        </div>
    </header>

    <div class="hero-section" data-aos="fade-down">
        <div class="hero-banner">
            <div class="hero-text">
                <h1>Le Plus Grand March√© Digital</h1>
                <p>Vos boutiques pr√©f√©r√©es au m√™me endroit.</p>
                <a href="#market-grid" class="hero-btn">Commencer</a>
            </div>
        </div>
    </div>

    <!-- BOUTIQUES -->
    <div class="shops-container-wrapper" data-aos="fade-up">
        <div class="shops-title">üè™ Boutiques Officielles</div>
        <div class="shops-section" id="shops-slider"></div>
    </div>

    <!-- COLLECTIONS (OPTION 1) -->
    <div class="container" style="max-width:1300px; margin:0 auto; padding:0 20px;" data-aos="fade-up">
        <div class="shops-title">‚ú® Univers</div>
        <div class="collections-grid">
            <div class="collection-card" onclick="filterByCategory('Mode')">
                <img src="https://images.unsplash.com/photo-1483985988355-763728e1935b?auto=format&fit=crop&w=400" alt="Mode">
                <div class="collection-text">Mode & Style</div>
            </div>
            <div class="collection-card" onclick="filterByCategory('√âlectronique')">
                <img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?auto=format&fit=crop&w=400" alt="Tech">
                <div class="collection-text">High-Tech</div>
            </div>
            <div class="collection-card" onclick="filterByCategory('Gastronomie')">
                <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=400" alt="Food">
                <div class="collection-text">Miam Miam</div>
            </div>
             <div class="collection-card" onclick="filterByCategory('Beaut√©')">
                <img src="https://images.unsplash.com/photo-1596462502278-27bfdd403cc2?auto=format&fit=crop&w=400" alt="Beaut√©">
                <div class="collection-text">Beaut√©</div>
            </div>
        </div>
    </div>

    <!-- CARTE (OPTION 10 PREPARED) -->
    <div class="map-section" data-aos="fade-up">
        <div class="shops-title">üó∫Ô∏è Carte des Vendeurs</div>
        <div class="map-wrapper" id="map-wrapper">
            <div id="map-container"></div>
            <div class="map-overlay" onclick="enableMap()">
                <div class="map-btn">üëÜ Toucher pour explorer</div>
            </div>
        </div>
    </div>

    <div class="main-layout">
        <!-- Sidebar Filtres -->
        <aside class="sidebar" id="sidebar-filters">
            <div class="close-filter" id="close-filter-btn">&times;</div>
            <div class="filter-group">
                <span class="filter-head">Boutiques</span>
                <div id="shop-filters"></div>
            </div>
            <div class="filter-group">
                <span class="filter-head">Cat√©gories</span>
                <div id="category-filters"></div>
            </div>
        </aside>

        <!-- Contenu -->
        <main>
            <button id="toggle-filters" class="mobile-filter-btn">üå™Ô∏è Filtrer</button>
            <div class="sidebar-overlay" id="sidebar-overlay"></div>

            <div id="flash-sales-container"></div>

            <div id="loader" style="text-align:center; padding:50px; color:#888;">Chargement...</div>
            <div id="market-grid" class="grid"></div>
            
            <div id="load-more-container" style="text-align:center; margin-top:30px; display:none;">
                <button id="load-more-btn" class="seller-link" style="border:none; cursor:pointer;">Voir plus ‚Üì</button>
            </div>
        </main>
    </div>

    <!-- FOOTER -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-col">
                <a href="#" class="logo" style="color:white; margin-bottom:15px; display:block;">EM <span>AREA</span></a>
                <p>La premi√®re plateforme digitale qui connecte commer√ßants et acheteurs.</p>
            </div>
            <div class="footer-col">
                <h3>Stats</h3>
                <div class="footer-stats">
                    <div class="stat-pill">üõçÔ∏è <span id="shop-count">0</span> Boutiques</div>
                    <div class="stat-pill">üë• <span id="smart_uv">...</span> Visiteurs</div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2025 EM AREA - Tous droits r√©serv√©s.
        </div>
    </footer>

    <!-- Scripts -->
    <script src="aggregator.js"></script>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        AOS.init();
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => navigator.serviceWorker.register('/sw.js')); }

        // Dark Mode Logic
        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const target = current === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', target);
            localStorage.setItem('theme', target);
        }
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
        document.getElementById('theme-toggle-desktop').addEventListener('click', toggleTheme);

        // Map Logic
        function initMap() {
            const el = document.getElementById('map-container');
            if(!el) return;
            const map = L.map('map-container').setView([6.172, 1.23], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            setTimeout(() => {
                if(window.allShops) {
                    window.allShops.forEach(s => {
                        if(s.lat) L.marker([s.lat, s.lng]).addTo(map).bindPopup(`<b>${s.name}</b><br>${s.location}`);
                    });
                }
            }, 2000);
        }
        initMap();
        function enableMap() { document.getElementById('map-wrapper').classList.add('map-active'); }

        // Mobile Filters
        const fBtn = document.getElementById('toggle-filters');
        const fClose = document.getElementById('close-filter-btn');
        const sidebar = document.getElementById('sidebar-filters');
        const overlay = document.getElementById('sidebar-overlay');
        const toggleF = () => { sidebar.classList.toggle('active'); overlay.classList.toggle('active'); };
        if(fBtn) fBtn.addEventListener('click', toggleF);
        if(fClose) fClose.addEventListener('click', toggleF);
        if(overlay) overlay.addEventListener('click', toggleF);
        
        // Clic sur Collection
        window.filterByCategory = (cat) => {
            const checkboxes = document.querySelectorAll('#category-filters input');
            checkboxes.forEach(cb => {
                cb.checked = (cb.value === cat);
            });
            window.filterData(); // D√©clenche le filtre
            document.getElementById('market-grid').scrollIntoView({behavior:'smooth'});
        };
        
        // Stats
        async function updateUniqueVisitors() {
            const el = document.getElementById('smart_uv');
            try {
                const res = await fetch(`https://api.counterapi.dev/v1/em-area-market/visiteurs_uniques/up`);
                const data = await res.json();
                el.textContent = data.count;
            } catch { el.textContent = "100+"; }
        }
        updateUniqueVisitors();
    </script>
</body>
</html>
